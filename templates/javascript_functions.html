<script>
// SuperAudio Mini - Custom JavaScript Functions

// Theme Management
function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    
    // Update theme toggle button
    const themeBtn = document.querySelector('.theme-toggle');
    if (themeBtn) {
        themeBtn.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    }
}

// Progress Bar Animation
function updateProgress(elementId, percentage, animated = true) {
    const progressBar = document.getElementById(elementId);
    if (progressBar) {
        if (animated) {
            progressBar.style.transition = 'width 0.5s ease-in-out';
        }
        progressBar.style.width = percentage + '%';
    }
}

// Audio Control Functions
function toggleAudio(audioId) {
    const audio = document.getElementById(audioId);
    const playBtn = document.querySelector(`[onclick="toggleAudio('${audioId}')"]`);
    const playIcon = playBtn.querySelector('.play-icon');
    const pauseIcon = playBtn.querySelector('.pause-icon');
    
    if (audio.paused) {
        audio.play();
        playIcon.style.display = 'none';
        pauseIcon.style.display = 'inline';
    } else {
        audio.pause();
        playIcon.style.display = 'inline';
        pauseIcon.style.display = 'none';
    }
}

// Panel Management
function togglePanel(panelId) {
    const panel = document.getElementById(panelId + '-content');
    const btn = document.querySelector(`[onclick="togglePanel('${panelId}')"]`);
    
    if (panel.style.display === 'none') {
        panel.style.display = 'block';
        btn.innerHTML = '‚àí';
        panel.classList.add('slide-down');
    } else {
        panel.style.display = 'none';
        btn.innerHTML = '+';
        panel.classList.remove('slide-down');
    }
}

// Message Functions
function copyMessage(messageId) {
    const message = document.querySelector(`[data-message-id="${messageId}"] .message-body`);
    if (message) {
        navigator.clipboard.writeText(message.textContent);
        showNotification('Message copied to clipboard!', 'success');
    }
}

function shareMessage(messageId) {
    const message = document.querySelector(`[data-message-id="${messageId}"] .message-body`);
    if (message && navigator.share) {
        navigator.share({
            title: 'SuperAudio Mini Message',
            text: message.textContent
        });
    }
}

// Tool Functions
function applyTool(toolId) {
    showNotification(`Applying tool: ${toolId}`, 'info');
    updateProgress('main-progress-bar', 0);
    
    // Simulate progress
    let progress = 0;
    const interval = setInterval(() => {
        progress += 20;
        updateProgress('main-progress-bar', progress);
        
        if (progress >= 100) {
            clearInterval(interval);
            showNotification('Tool applied successfully!', 'success');
            setTimeout(() => {
                updateProgress('main-progress-bar', 0);
            }, 2000);
        }
    }, 500);
}

function showToolInfo(toolId) {
    // Create modal or expand tool information
    const toolCard = document.querySelector(`[data-tool-id="${toolId}"]`);
    if (toolCard) {
        toolCard.classList.toggle('expanded');
    }
}

// Notification System
function showNotification(message, type = 'info', duration = 3000) {
    const notification = document.createElement('div');
    notification.className = `notification ${type} fade-in`;
    notification.innerHTML = `
        <div class="notification-content">
            <span class="notification-icon">${getNotificationIcon(type)}</span>
            <span class="notification-message">${message}</span>
            <button class="notification-close" onclick="this.parentElement.parentElement.remove()">√ó</button>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Auto remove after duration
    setTimeout(() => {
        if (notification.parentElement) {
            notification.classList.add('fade-out');
            setTimeout(() => {
                notification.remove();
            }, 300);
        }
    }, duration);
}

function getNotificationIcon(type) {
    const icons = {
        'success': '‚úÖ',
        'error': '‚ùå',
        'warning': '‚ö†Ô∏è',
        'info': '‚ÑπÔ∏è'
    };
    return icons[type] || icons.info;
}

// Processing Steps Management
function updateProcessingStep(stepName, status = 'active') {
    const steps = document.querySelectorAll('.step-item');
    let foundCurrent = false;
    
    steps.forEach(step => {
        const stepData = step.getAttribute('data-step');
        const statusElement = step.querySelector('.step-status');
        
        if (stepData === stepName) {
            step.classList.add(status);
            if (status === 'completed') {
                statusElement.textContent = '‚úì';
            } else if (status === 'active') {
                statusElement.textContent = '‚óê';
            } else if (status === 'error') {
                statusElement.textContent = '‚úó';
            }
            foundCurrent = true;
        } else if (foundCurrent) {
            // Reset future steps
            step.classList.remove('active', 'completed', 'error');
            statusElement.textContent = '‚óã';
        } else {
            // Mark previous steps as completed
            step.classList.add('completed');
            statusElement.textContent = '‚úì';
        }
    });
}

// Waveform Visualization (placeholder)
function drawWaveform(canvasId, audioData) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    
    // Clear canvas
    ctx.clearRect(0, 0, width, height);
    
    // Draw waveform
    ctx.beginPath();
    ctx.strokeStyle = '#6366f1';
    ctx.lineWidth = 2;
    
    // Simplified waveform drawing
    for (let i = 0; i < width; i++) {
        const value = Math.sin(i * 0.1) * (height / 4) + (height / 2);
        if (i === 0) {
            ctx.moveTo(i, value);
        } else {
            ctx.lineTo(i, value);
        }
    }
    
    ctx.stroke();
}

// Statistics Updates
function updateStats() {
    const stats = {
        filesProcessed: parseInt(localStorage.getItem('files-processed') || '0'),
        totalProcessingTime: parseInt(localStorage.getItem('total-processing-time') || '0'),
        successCount: parseInt(localStorage.getItem('success-count') || '0')
    };
    
    // Update display
    document.getElementById('files-processed').textContent = stats.filesProcessed;
    
    const avgTime = stats.filesProcessed > 0 ? 
        (stats.totalProcessingTime / stats.filesProcessed).toFixed(1) : '0';
    document.getElementById('processing-time').textContent = avgTime + 's';
    
    const successRate = stats.filesProcessed > 0 ? 
        ((stats.successCount / stats.filesProcessed) * 100).toFixed(0) : '100';
    document.getElementById('success-rate').textContent = successRate + '%';
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    // Load saved theme
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    
    // Update stats
    updateStats();
    
    // Initialize waveforms
    const waveformCanvases = document.querySelectorAll('.waveform-canvas');
    waveformCanvases.forEach(canvas => {
        drawWaveform(canvas.id, []);
    });
    
    // Add smooth scrolling
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});

// Export functions for use in other scripts
window.SuperAudioUI = {
    toggleTheme,
    updateProgress,
    toggleAudio,
    togglePanel,
    showNotification,
    updateProcessingStep,
    updateStats,
    drawWaveform
};
</script>
